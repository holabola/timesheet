<style>
  .table-responsive {

  }

  html {
    width: 1600px;
  }
  .custom-combobox {
    position: relative;
    display: inline-block;
  }
  .custom-combobox-toggle {
    position: absolute;
    top: 0;
    bottom: 0;
    margin-left: -1px;
    padding: 0;
  }
  .custom-combobox-input {
    margin: 0;
    padding: 5px 10px;
  }
  .event a {
    background-color: #EC971F !important;
    background-image :none !important;
    color: #ffffff !important;
  }
  .css-class-to-highlight a {
    background-color: #910101 !important;
    background-image :none !important;
    color: #efefef !important;
  }
  .css-class-to-highlight-good a {
    background-color: #218212 !important;
    background-image :none !important;
    color: #efefef !important;
  }
  .ui-datepicker-current-day a {
    background-color: #007fff !important;
    background-image :none !important;
    color: #efefef !important;
  }

</style>
<script>

  function newTotalFunction() {
      var nameArray = [];

      $('#tableElements').children('tr').each(function () {
          //find names
          var name = $(this).find('#names').text();
          if (jQuery.inArray(name,nameArray) == -1 ) {
              nameArray.push(name);
          } else {

          }
      });

      var sunTotal,monTotal,tueTotal,wedTotal,thuTotal,friTotal,satTotal,totalTotal,approvalStatus,submittedStatus;
      sunTotal = [], monTotal = [], tueTotal = [], wedTotal = [], thuTotal = [], friTotal = [], satTotal = [], totalTotal = [], approvalStatus = [], submittedStatus = [];

      for (var i = 0;i < nameArray.length;i++) {
          sunTotal[i] = 0.00, monTotal[i] = 0.00, tueTotal[i] = 0.00, wedTotal[i] = 0.00, thuTotal[i] = 0.00, friTotal[i] = 0.00, satTotal[i] = 0.00, totalTotal[i] = 0.00;
          $('#tableElements').children('tr').each(function () {
              if (moment($(this).children('.dateBlob').text()) <= lastday && moment($(this).children('.dateBlob').text()) >= firstday && $(this).find("#names").text().trim() == nameArray[i] ) {

                  if (parseFloat($(this).find(".sunEntry").text()) != NaN) {
                      sunTotal[i] += parseFloat($(this).find(".sunEntry").text());
                      }
                  if (parseFloat($(this).find(".monEntry").text()) != NaN) {
                      monTotal[i] += parseFloat($(this).find(".monEntry").text());
                  }
                  if (parseFloat($(this).find(".tueEntry").text()) != NaN) {
                      tueTotal[i] += parseFloat($(this).find(".tueEntry").text());
                  }
                  if (parseFloat($(this).find(".wedEntry").text()) != NaN) {
                      wedTotal[i] += parseFloat($(this).find(".wedEntry").text());
                  }
                  if (parseFloat($(this).find(".thuEntry").text()) != NaN) {
                      thuTotal[i] += parseFloat($(this).find(".thuEntry").text());
                  }
                  if (parseFloat($(this).find(".friEntry").text()) != NaN) {
                      friTotal[i] += parseFloat($(this).find(".friEntry").text());
                  }
                  if (parseFloat($(this).find(".satEntry").text()) != NaN) {
                      satTotal[i] += parseFloat($(this).find(".satEntry").text());
                  }
                  if (parseFloat($(this).find(".totalEntry").text()) != NaN) {
                      totalTotal[i] += parseFloat($(this).find(".totalEntry").text());
                  }
                  approvalStatus[i] = $(this).find("#approval").text();
                  submittedStatus[i] = $(this).find("#submittedStatus").text();

              } else {

              }
          });
      }

      $(".frontTable").each(function() {
          for (var z = 0; z < nameArray.length; z++) {
            if ($(this).attr("id") == nameArray[z]) {
                width = (totalTotal[z] / 40)*100;
                $(this).find("#progressbar").css('width',(width + "%"));
                $(this).find("#progressbartext").text(totalTotal[z]);
                $(this).find("#approvalCover").text(submittedStatus[z]);
                if (totalTotal[z] < 40 || totalTotal[z] > 80 ) {
                    $(this).find("#progressbar").removeClass("progress-bar-success");
                    $(this).find("#progressbar").addClass("progress-bar-danger");
                } else {
                    $(this).find("#progressbar").removeClass("progress-bar-danger");
                    $(this).find("#progressbar").addClass("progress-bar-success");
                }
                var counter = 0;
                $(this).find(".manySubmitButtons").each(function() {
                    if ($(this).attr("data-extra") == nameArray[z] && counter == 0 && moment($(this).attr("data-date")) <= lastday && moment($(this).attr("data-date")) >= firstday) {
                        $(this).css("display","");
                        $(this).parent().parent().parent().find("#idholder").text( $(this).find("#idholderinside").text() );
                        counter = 1;
                    } else {
                        $(this).css("display","none");
                    }

                });
            }
          }
            if ($(this).find("#progressbartext").text() == 0) {
              $(this).find(".manySubmitButtons").each(function() {
                 $(this).css("display","none");
              });
          }
          if ($(this).find("#approvalCover").text() != "Submitted") {
              $(this).find(".manySubmitButtons").each(function() {
                  $(this).css("display","none");
              });
          }
      });

  }

    function calendarHighlight() {
        //Init Datepicker and add Highlights if timesheets aren't finished

        var counter = 0;
        var test = [];
        eventDates = [], eventDatesGood = [];
        dateRange = [], sun = [], mon = [], tue = [], wed = [], thu = [], fri = [], sat = [], total = [];
        var first, countz, curr;
        $('.timesheetEntry').each(function () {
          name = $('#UserSearch').val().trim();
          nameEntry = $(this).find("#names").text();
          //alert(name + "...." + nameEntry);
          if (name == nameEntry) {
              curr = new Date(moment($(this).find(".dateBlob").text()));
              first = new Date(curr.setDate(curr.getDate() - curr.getDay()));
              if (test.indexOf(first.toString().substring(0, 10)) == -1) {
                  test[counter] = first.toString().substring(0, 10);
                  dateRange[counter] = first;
                  sun[counter] = parseFloat($(this).find(".sunEntry").text());
                  mon[counter] = parseFloat($(this).find(".monEntry").text());
                  tue[counter] = parseFloat($(this).find(".tueEntry").text());
                  wed[counter] = parseFloat($(this).find(".wedEntry").text());
                  thu[counter] = parseFloat($(this).find(".thuEntry").text());
                  fri[counter] = parseFloat($(this).find(".friEntry").text());
                  sat[counter] = parseFloat($(this).find(".satEntry").text());
                  total[counter] = parseFloat($(this).find(".totalEntry").text());
                  counter += 1;
              } else {
                  sun[test.indexOf(first.toString().substring(0, 10))] = sun[test.indexOf(first.toString().substring(0, 10))] + parseFloat($(this).find(".sunEntry").text());
                  mon[test.indexOf(first.toString().substring(0, 10))] = mon[test.indexOf(first.toString().substring(0, 10))] + parseFloat($(this).find(".monEntry").text());
                  tue[test.indexOf(first.toString().substring(0, 10))] = tue[test.indexOf(first.toString().substring(0, 10))] + parseFloat($(this).find(".tueEntry").text());
                  wed[test.indexOf(first.toString().substring(0, 10))] = wed[test.indexOf(first.toString().substring(0, 10))] + parseFloat($(this).find(".wedEntry").text());
                  thu[test.indexOf(first.toString().substring(0, 10))] = thu[test.indexOf(first.toString().substring(0, 10))] + parseFloat($(this).find(".thuEntry").text());
                  fri[test.indexOf(first.toString().substring(0, 10))] = fri[test.indexOf(first.toString().substring(0, 10))] + parseFloat($(this).find(".friEntry").text());
                  sat[test.indexOf(first.toString().substring(0, 10))] = sat[test.indexOf(first.toString().substring(0, 10))] + parseFloat($(this).find(".satEntry").text());
                  total[test.indexOf(first.toString().substring(0, 10))] = total[test.indexOf(first.toString().substring(0, 10))] + parseFloat($(this).find(".totalEntry").text());

              }
          }
        });

        counter = 0;
        countz = 0;
        dateRange.forEach(function (entry) {
            if (total[counter] >= 40) {
                eventDatesGood[countz] = new Date(entry.setDate(entry.getDate()));
                countz += 1;
                for (index = countz; index < countz + 6; ++index) {
                    eventDatesGood[index] = new Date(entry.setDate(entry.getDate() + 1));
                }
                countz += 6;
            }
            else {
                eventDates[countz] = new Date(entry.setDate(entry.getDate()));
                countz += 1;
                for (index = countz; index < countz + 6; ++index) {
                    eventDates[index] = new Date(entry.setDate(entry.getDate() + 1));
                }
                countz += 6;
            }
            counter += 1;
        });

        var datesave = $('#datepicker').datepicker('getDate');
        $("#datepicker").datepicker('destroy');
        $("#datepicker").datepicker({
            beforeShowDay: function (date) {
                for (var i = 0; i < eventDates.length; i++) {
                    if (new Date(eventDates[i]).toString() == date.toString()) {
                        return [true, 'css-class-to-highlight', 'tooltip text'];
                    }
                }
                for (var i = 0; i < eventDatesGood.length; i++) {
                    if (new Date(eventDatesGood[i]).toString() == date.toString()) {
                        return [true, 'css-class-to-highlight-good', 'tooltip text'];
                    }
                }
                return [true, ''];
            }
        });
        $("#datepicker").datepicker('setDate',datesave);
    }

    function totalColumns() {
        var sunTotal,monTotal,tueTotal,wedTotal,thuTotal,friTotal,satTotal,totalTotal;
        sunTotal = 0.00, monTotal = 0.00, tueTotal = 0.00, wedTotal = 0.00, thuTotal = 0.00, friTotal = 0.00, satTotal = 0.00, totalTotal = 0.00;

        $(".sunEntry").each(function () {
            if (parseFloat($(this).text()) != NaN && $(this).closest('tr').css("display") != "none") {
                sunTotal += parseFloat($(this).text());
            }
        });
        $(".monEntry").each(function () {
            if (parseFloat($(this).text()) != NaN && $(this).closest('tr').css("display") != "none") {
                monTotal += parseFloat($(this).text());
            }
        });
        $(".tueEntry").each(function () {
            if (parseFloat($(this).text()) != NaN && $(this).closest('tr').css("display") != "none") {
                tueTotal += parseFloat($(this).text());
            }
        });
        $(".wedEntry").each(function () {
            if (parseFloat($(this).text()) != NaN && $(this).closest('tr').css("display") != "none") {
                wedTotal += parseFloat($(this).text());
            }
        });
        $(".thuEntry").each(function () {
            if (parseFloat($(this).text()) != NaN && $(this).closest('tr').css("display") != "none") {
                thuTotal += parseFloat($(this).text());
            }
        });
        $(".friEntry").each(function () {
            if (parseFloat($(this).text()) != NaN && $(this).closest('tr').css("display") != "none") {
                friTotal += parseFloat($(this).text());
            }
        });
        $(".satEntry").each(function () {
            if (parseFloat($(this).text()) != NaN && $(this).closest('tr').css("display") != "none") {
                satTotal += parseFloat($(this).text());
            }
        });
        $(".totalEntry").each(function () {
            if (parseFloat($(this).text()) != NaN && $(this).closest('tr').css("display") != "none") {
                totalTotal += parseFloat($(this).text());
            }
        });
        $("#totalSun").text(sunTotal);
        $("#totalMon").text(monTotal);
        $("#totalTue").text(tueTotal);
        $("#totalWed").text(wedTotal);
        $("#totalThu").text(thuTotal);
        $("#totalFri").text(friTotal);
        $("#totalSat").text(satTotal);
        $("#totalTotal").text(totalTotal);

        var totalVisibleNames = [];
        $(".namesz").each(function() {
            if (totalVisibleNames.indexOf($(this).text()) == -1 && $(this).parent().css("display") != "none") {
                totalVisibleNames.push($(this).text());
            }
        });

        if(sunTotal < (8 * totalVisibleNames.length)) {
            $("#totalSun").closest("td").addClass("danger");
        } else { $("#totalSun").closest("td").removeClass("danger"); }
        if(monTotal < (8 * totalVisibleNames.length)) {
            $("#totalMon").closest("td").addClass("danger");
        } else { $("#totalMon").closest("td").removeClass("danger"); }
        if(tueTotal < (8 * totalVisibleNames.length)) {
            $("#totalTue").closest("td").addClass("danger");
        } else { $("#totalTue").closest("td").removeClass("danger"); }
        if(wedTotal < (8 * totalVisibleNames.length)) {
            $("#totalWed").closest("td").addClass("danger");
        } else { $("#totalWed").closest("td").removeClass("danger"); }
        if(thuTotal < (8 * totalVisibleNames.length)) {
            $("#totalThu").closest("td").addClass("danger");
        } else { $("#totalThu").closest("td").removeClass("danger"); }
        if(friTotal < (8 * totalVisibleNames.length)) {
            $("#totalFri").closest("td").addClass("danger");
        } else { $("#totalFri").closest("td").removeClass("danger"); }
        if(satTotal < (8 * totalVisibleNames.length)) {
            $("#totalSat").closest("td").addClass("danger");
        } else { $("#totalSat").closest("td").removeClass("danger"); }
        if(totalTotal < (40 * totalVisibleNames.length)) {
            $("#totalTotal").closest("td").addClass("danger");
        } else { $("#totalTotal").closest("td").removeClass("danger"); }

        // Adding red to bottom if there is red anywhere

        if($("#totalTotal").closest("td").hasClass("danger") ) {
            $(".otherTotalCol").each(function() {
                $(this).addClass("danger");
            });
        } else {
            $(".otherTotalCol").each(function() {
                $(this).removeClass("danger");
            });
        }
    }

  $(function() {

    $('.selectpicker').selectpicker();
      var heights = 0;

  });


  $( "body" ).click(function( event ) {

    if (event.target.id == "successBut") {
        //userid = ".userid-" + $(event.target).parent().parent().parent().parent().find("#userid").text();
        //$(userid).each(function() {
           $(event.target).parent().parent().find("#failBut").removeClass();
           $(event.target).parent().parent().find("#successBut").removeClass();
           $(event.target).parent().parent().find("#successBut").addClass("btn btn-success hvr-radial-out-green");
           $(event.target).parent().parent().find("#failBut").addClass("btn btn-default hvr-radial-out");
        $(event.target).parent().parent().find("#successBut").text("Approved");
        $(event.target).parent().parent().find("#failBut").text("Unapprove");
        //});

    }
    else if (event.target.id == "failBut") {
        //userid = ".userid-" + $(event.target).parent().parent().parent().parent().find("#userid").text();
        //$(userid).each(function() {
            $(event.target).parent().parent().find("#failBut").removeClass();
            $(event.target).parent().parent().find("#successBut").removeClass();
            $(event.target).parent().parent().find("#successBut").addClass("btn btn-default hvr-radial-out-green");
            $(event.target).parent().parent().find("#failBut").addClass("btn btn-danger hvr-radial-out");
        $(event.target).parent().parent().find("#successBut").text("Approve");
        $(event.target).parent().parent().find("#failBut").text("Unapproved");
       // });
    }

  });
/*
  $(document).on('change', '#UserSearch', function() {
      var heights = 0;
    var selectedOption = $('#UserSearch').val().trim();
    if (selectedOption != "") {
      $('#tableElements').children('tr').each(function () {
        if (moment($(this).children('.dateBlob').text()) <= lastday && moment($(this).children('.dateBlob').text()) >= firstday && $(this).find("#names").text().trim() == selectedOption ) {
          $(this).css("display","");
          heights += 1;
        } else {
          $(this).css("display","none");
        }
      });
    }
    totalColumns();
    calendarHighlight();
  });
*/
  function dateUpdate() {
      var monthNames = ["January", "February", "March", "April", "May", "June",
          "July", "August", "September", "October", "November", "December"
      ];
      curr = $('#datepicker').datepicker('getDate');
      first = curr.getDate() - curr.getDay();
      firstday = new Date(curr.setDate(first));
      second = curr.getDate() +1;
      secondday = new Date(curr.setDate(second));
      third = curr.getDate() + 1;
      thirdday = new Date(curr.setDate(third));
      fourth = curr.getDate() + 1;
      fourthday = new Date(curr.setDate(fourth));
      fifth = curr.getDate() + 1;
      fifthday = new Date(curr.setDate(fifth));
      sixth = curr.getDate() + 1;
      sixthday = new Date(curr.setDate(sixth));
      last = curr.getDate() + 1;
      lastday = new Date(curr.setDate(last));

      $(".dateTitle").each(function() {
          $(this).text( (monthNames[firstday.getMonth()] ) + ' ' + firstday.getDate() + ', ' +  firstday.getFullYear() + " - " + (monthNames[lastday.getMonth()] ) + ' ' + lastday.getDate() + ', ' +  lastday.getFullYear() );
      });
       $('#Date1').text("Sun " + firstday.getDate() );
      $('#Date2').text("Mon " + secondday.getDate() );
      $('#Date3').text("Tue " + thirdday.getDate() );
      $('#Date4').text("Wed " + fourthday.getDate() );
      $('#Date5').text("Thu " + fifthday.getDate() );
      $('#Date6').text("Fri " + sixthday.getDate() );
      $('#Date7').text("Sat " + lastday.getDate() );


      $('#datePicked').val($('#datepicker').datepicker('getDate'));

      var heights = 0;
      $('#tableElements').children('tr').each(function () {
          var selectedOption;
          if (selectedOption != "") {
              $('#tableElements').children('tr').each(function () {
                  if (moment($(this).children('.dateBlob').text()) <= lastday && moment($(this).children('.dateBlob').text()) >= firstday && $(this).find("#names").text().trim() == selectedOption ) {
                      $(this).css("display","");
                      heights += 1;
                  } else {
                      $(this).css("display","none");
                  }
              });
          } else {
              if (moment($(this).children('.dateBlob').text()) <= lastday && moment($(this).children('.dateBlob').text()) >= firstday) {
                  $(this).css("display", "");
                  heights += 1;
                  $(this).children('td').each(function () {
                      var str = $(this).text();
                      if (str.length > 14 && $(this).attr("id") != "names" && $(this).attr('id') != "butonz" && $(this).attr('class') != "dropdown") {
                          str = str.substring(0, 15) + "...";
                          $(this).text(str);
                      }
                  });

              } else {
                  $(this).css("display", "none");
                  // alert($(this).children('.dateBlob').text() + "      " + $.datepicker.formatDate("yy-mm-dd", curr) );
              }
          }
      });
  }


  var curr, first, second, third, fourth, fifth, sixth, last, firstday, lastday, secondday, thirdday, fourthday, fifthday, sixthday;

  $(document).on('change', '#datepicker', function() {

    var monthNames = ["January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];

    //waits until fadeout is completed can calls the rest
      $("#dashContents").fadeOut();

      $('#datePicked').val($('#datepicker').datepicker('getDate'));

      var heights = 0;
      $('#tableElements').children('tr').each(function () {
          var selectedOption;
          if (selectedOption != "") {
              $('#tableElements').children('tr').each(function () {
                  if (moment($(this).children('.dateBlob').text()) <= lastday && moment($(this).children('.dateBlob').text()) >= firstday && $(this).find("#names").text().trim() == selectedOption) {
                      $(this).css("display", "");
                      heights += 1;
                  } else {
                      $(this).css("display", "none");
                  }
              });
          } else {
              if (moment($(this).children('.dateBlob').text()) <= lastday && moment($(this).children('.dateBlob').text()) >= firstday) {
                  $(this).css("display", "");
                  heights += 1;
                  $(this).children('td').each(function () {
                      var str = $(this).text();
                      if (str.length > 14 && $(this).attr("id") != "names" && $(this).attr('id') != "butonz" && $(this).attr('class') != "dropdown") {
                          str = str.substring(0, 15) + "...";
                          $(this).text(str);
                      }
                  });

              } else {
                  $(this).css("display", "none");
                  // alert($(this).children('.dateBlob').text() + "      " + $.datepicker.formatDate("yy-mm-dd", curr) );
              }
          }
      });
      heights = 60 + (60 * heights);
      $('#pageGapDash').css("height", 420);


      //Saves date local variable
      sessionStorage.datePicked = $('#datepicker').datepicker('getDate');


      //total all the entries
      setTimeout(dateUpdate,400);
      setTimeout(totalColumns,400);
      setTimeout(newTotalFunction,400);
      $("#wholeWrapper").css("display","none");
      $("#expenseWrap").slideDown();

      $("#dashContents").fadeIn();

  });

  $( document ).ready(function() {

      if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
          $('#sidebarNav').find('[datePickerTag="first"]').removeAttr("id");
      }
      else {
          $('#sidebarNav').find('[datePickerTag="first"]').attr("id","datepicker");
          $('#aboveTable').find('[datePickerTag="last"]').css("display","none");
      }

    var monthNames = ["January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    var nameArray = [];

      //Init Datepicker
    var eventDates = {};
    $('.timesheetEntry').each(function() {
      var approval = $(this).find('#approval').text();
      var datez = $(this).find('#dateOfTime').text();
      if (approval == "Pending" || approval == "") {
        eventDates[new Date(moment(datez))] = new Date(moment(datez));
      }
    });
    $("#datepicker").datepicker( {
      beforeShowDay: function( date ) {
        var highlight = eventDates[date];
        if( highlight ) {
          return [true, "event", 'Tooltip text'];
        } else {
          return [true, '', ''];
        }
      }
    });

    //Get rid of notes for ones that don't exist

      $(".noteclass").each(function () {
          if ($(this).text() == "") {
              $(this).closest(".dropdown").find(".dropdown-toggle").css("display","none");
          }
      });


      if (sessionStorage.refreshCount == undefined) {
      $("#datepicker").datepicker().datepicker("setDate", new Date());
      sessionStorage.refreshCount = 1;
    } else {
      var date = sessionStorage.datePicked;
      date = new Date(date);
      date.setDate(date.getDate());

      $("#datepicker").datepicker().datepicker("setDate", date );
    }
    sessionStorage.refreshCount = sessionStorage.refreshCount + 1;
    //new Date("10/10/2016")

    curr = $('#datepicker').datepicker('getDate');
    first = curr.getDate() - curr.getDay();

    firstday = new Date(curr.setDate(first));
    second = curr.getDate() +1;
    secondday = new Date(curr.setDate(second));
    third = curr.getDate() + 1;
    thirdday = new Date(curr.setDate(third));
    fourth = curr.getDate() + 1;
    fourthday = new Date(curr.setDate(fourth));
    fifth = curr.getDate() + 1;
    fifthday = new Date(curr.setDate(fifth));
    sixth = curr.getDate() + 1;
    sixthday = new Date(curr.setDate(sixth));
    last = curr.getDate() + 1;
    lastday = new Date(curr.setDate(last));

      $(".dateTitle").each(function() {
          $(this).text( (monthNames[firstday.getMonth()] ) + ' ' + firstday.getDate() + ', ' +  firstday.getFullYear() + " - " + (monthNames[lastday.getMonth()] ) + ' ' + lastday.getDate() + ', ' +  lastday.getFullYear() );
      });
   $('#Date1').text("Sun " + firstday.getDate() );
    $('#Date2').text("Mon " + secondday.getDate() );

    $('#Date3').text("Tue " + thirdday.getDate() );
    $('#Date4').text("Wed " + fourthday.getDate() );
    $('#Date5').text("Thu " + fifthday.getDate() );
    $('#Date6').text("Fri " + sixthday.getDate() );
    $('#Date7').text("Sat " + lastday.getDate() );

    $('#datePicked').val($('#datepicker').datepicker('getDate'));

    $('#tableElements').children('tr').each(function () {
      if (moment($(this).children('.dateBlob').text()) <= lastday && moment($(this).children('.dateBlob').text()) >= firstday) {
        $(this).css("display","");
        $(this).children('td').each(function () {
          var str = $(this).text();
          if(str.length > 14 && $(this).attr("id") != "names" && $(this).attr('id') != "butonz" && $(this).attr('class') != "dropdown") {
            str = str.substring(0, 15) + "...";
            $(this).text(str);
          }
        });

      } else {
        $(this).css("display","none");
        // alert($(this).children('.dateBlob').text() + "      " + $.datepicker.formatDate("yy-mm-dd", curr) );
      }

      //find names
      var name = $(this).find('#names').text();
      if (jQuery.inArray(name,nameArray) == -1 ) {
        nameArray.push(name);
        $('#UserSearch').append('<option data-icon="glyphicon-user">' + name + '</option>');
        $('.selectpicker').selectpicker('refresh');
      } else {

      }
    });


    //Saves date local variable
    sessionStorage.datePicked = $('#datepicker').datepicker('getDate');


    //Approval Buttons
    $('.approvalButtons').each(function() {
      var approval = $(this).find('#ApprovalBlob').val();
      $(this).find('#successBut').className = '';
      $(this).find('#failBut').className = '';
      if (approval == "Approved") {
        $(this).find('#successBut').addClass("btn btn-success ");
        $(this).find('#failBut').addClass("btn btn-default ");
        $(this).find("#successBut").text("Approved");
        $(this).find("#failBut").text("Unapprove");
      }
      if (approval == "Unapproved") {
        $(this).find('#successBut').addClass("btn btn-default ");
        $(this).find('#failBut').addClass("btn btn-danger ");
          $(this).find("#successBut").text("Approve");
          $(this).find("#failBut").text("Unapproved");
          $(this).find('#failBut').css("background","color:#d9534f")
      }
      if (approval == "Pending" || approval == "") {
        $(this).find('#successBut').addClass("btn btn-warning");
        $(this).find('#failBut').addClass("btn btn-warning ");
          $(this).find("#successBut").text("Approve");
          $(this).find("#failBut").text("Unapprove");
      }
    });

    //counts height of table
      var heights = 0;
      $('.timesheetEntry').each(function() {
          heights += 1;
      });
      heights = 60 + (60 * heights);
      $('#pageGapDash').css("height",420);

      //HEIGHT IS DEPRICATED RIGHT NOW. JUST DEFAULTED TO 420


      //total all the entries
    totalColumns();
    newTotalFunction();

      $('#tableElements').children('tr').each(function () {
        $(this).find('#successBut').trigger("submit.rails");
      });

      $(".frontTable").click(function(event) {
          if (event.target.id == "successBut" || event.target.id == "failBut") {
              return;
          }
          id=$(this).data("id");
          $(".timesheetEntry").each(function() {
              if ($(this).find("#userid").text() == id) {
                  if (moment($(this).children('.dateBlob').text()) <= lastday && moment($(this).children('.dateBlob').text()) >= firstday) {
                      $(this).css("display", "");
                  }
              } else {
                  $(this).css("display","none");
              }
          });
          selectedName = $(this).attr("id");
          $("#nameForTable").text("Name: " + selectedName);
          totalColumns();
          newTotalFunction();
          $("#expenseWrap").slideUp();
          $("#wholeWrapper").slideDown();
      });


      $('#clearMonth').click(function() {
          $("#wholeWrapper").css("display","none");
         $("#expenseWrap").slideDown();
      });


  });

    $.fn.simulateClick = function() {
        return this.each(function() {
            if('createEvent' in document) {
                var doc = this.ownerDocument,
                    evt = doc.createEvent('MouseEvents');
                evt.initMouseEvent('click', true, true, doc.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
                this.dispatchEvent(evt);
            } else {
                this.click(); // IE
            }
        });
    }

  $(window).scroll(function (event) {
    var scroll = $(window).scrollLeft();
    if (scroll > 50 ) {
      $('#submitBut').css('position','fixed');
    }
    else {
      $('#submitBut').css('position','');
    }
    // Do something
  });

  $(".dropdown-menu li a").click(function(){
    $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
    $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
  });

  var sum;
  $(document).on('change', '.numb', function() {
    sum = 0;
    $('.numb').each(function () {
      sum = sum + Number($(this).val());
    });
    $('#totalNew').val(sum);
  });

  function validate(evt) {
    var theEvent = evt || window.event;
    var key = theEvent.keyCode || theEvent.which;
    key = String.fromCharCode( key );
    var regex = /[0-9]|\./;
    if( !regex.test(key) ) {
      theEvent.returnValue = false;
      if(theEvent.preventDefault) theEvent.preventDefault();
    }



  }




</script>
</head>




<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" style="float:left;" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Project name</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/timesheet" >Timesheet</a></li>
        <% if current_user.admin == true %>
        <li><a href="/approvals" >Timesheet Approvals</a></li>
            <% end %>
        <li><a href="/expenses" >Expenses</a></li>
        <% if current_user.admin == true %>
        <li><a href="/expensesapprovals" >Expenses Approvals</a></li>
        <li><a href="/exports" >Exports</a></li>
            <% end %>
        <li><%= link_to "Settings", edit_user_registration_path(@user) %></li>
        <li><%= link_to('Logout', destroy_user_session_path, :method => :get) %></li>
      </ul>

    </div>
  </div>
</nav>



    <div class="container-fluid" >
      <div class="row">
        <div class="col-sm-3 col-md-2 sidebar" id="sidebarNav">

          <h2 style="text-align: center;">Approvals</h2>

          <div style="" id="datepicker" datePickerTag="first"></div>
          <br>
          <ul class="nav nav-sidebar">
            <li><a class="hvr-sweep-to-right" href="/" >Timesheet<span class="glyphicon glyphicon-time pull-right"></span></a></li>
            <% if current_user.admin == true %>
                <li class="active"><a class="hvr-sweep-to-right" href="/approvals">Timesheet Approvals<span class="sr-only">(current)</span><span class="glyphicon glyphicon-ok-circle pull-right"></span></a></li>
            <% end %>
            <li ><a class="hvr-sweep-to-right" href="/expenses">Expenses<span class="glyphicon glyphicon-usd pull-right"></span></a></li>
            <% if current_user.admin == true %>
                <li ><a class="hvr-sweep-to-right" href="/expensesapprovals">Expenses Approvals<span class="glyphicon glyphicon-ok pull-right"></span></a></li>
                <li><a class="hvr-sweep-to-right" href="/exports">Exports<span class="glyphicon glyphicon-floppy-save pull-right"></span></a></li>
                <li><a class="hvr-sweep-to-right" href="/employees">Employees<span class="glyphicon glyphicon-user pull-right"></span></a></li>
            <% end %>
          </ul>
          <!-- <ul class="nav nav-sidebar">
             <li><a href="">Nav item</a></li>
             <li><a href="">Nav item again</a></li>
             <li><a href="">One more nav</a></li>
             <li><a href="">Another nav item</a></li>
             <li><a href="">More navigation</a></li>
           </ul>
           <ul class="nav nav-sidebar">
             <li><a href="">Nav item again</a></li>
             <li><a href="">One more nav</a></li>
             <li><a href="">Another nav item</a></li>
           </ul> -->
        </div>

        <%= render "approvalcover" %>
        <div id="wholeWrapper" style="display:none;" >


        <div id="dashContents">
          <div id="aboveTable" style="">
            <h2 class="page-header dateTitle" style="margin-bottom:0px;"></h2>
            <h4 id="nameForTable" style="color:black;margin-top:10px;margin-bottom:30px;">Name</h4>
            <!--<p style="">Sheets yet to be approved appear yellow. Just hit the check or x to approve or unapprove.</p>
            <div datePickerTag="last">
              <label id="labelforlast">Select Date: </label>
              <input style="" id="datepicker">
              <br>
            </div>
            <label for="UserSearch">Search by User:</label>
            <select style="margin:2px;" class="selectpicker" id="UserSearch" title="Search by User...">

            </select>-->
          </div>
          <br>



          <h2 class="sub-header">&nbsp;</h2>
          <div class="table-responsive" id="pageGapDash">

            <table class="table table-striped" style="font-size:12px;">
              <thead>
              <tr style="padding: 8px 8px 8px 0px;">

                <th style="width:150px;">Credit Union</th>
                <th style="width:150px;">Activity</th>
                <th style="width:120px;">Task</th>
                <th style="width:130px;">Billing Options</th>
                <th style="width:80px;" id="Date1"></th>
                <th style="width:80px;" id="Date2"></th>
                <th style="width:80px;" id="Date3"></th>
                <th style="width:80px;" id="Date4"></th>
                <th style="width:80px;" id="Date5"></th>
                <th style="width:80px;" id="Date6"></th>
                <th style="width:80px;" id="Date7"></th>
                <th >Total</th>

              </tr>
              </thead>
              <tbody>
              <tr >

              </tr>
</tbody>

              <tbody id="tableElements">
              <% @pages.each do |p| %>
                  <tr id="row_<%= p.id %>" class="timesheetEntry">
                    <td style="display:none;"><p class="userid-<%= p.user_id %>" id="userid" style="display:none;"><%= p.user_id %></p></td>
                    <td style="display:none;" id="butonz"><div class="btn-group approvalButtons" role="group" aria-label="..."><%= form_for(p, remote: true, :url => {:action => 'update', :id => p.id}) do |f| %><%= f.text_field :approval, :value => p.approval,  :style => "display:none;", :id => "ApprovalBlob" %><%= button_tag "Approve", type: 'submit', class: "successButt", id:"successBut", name: "subaction", value: "Approved" %><%= button_tag "Reject", type: 'submit', class: "btn btn-default failButt", id: "failBut", name: "subaction", value: "Unapproved" %> </div>
                      <% end %>
                      </td>
                    <td id="approval" style="display:none;"><%= p.approval %></td>
                    <td style="display:none;" id="dateOfTime"><%= p.date_of_time %></td>
                    <td style="display:none;" class="namesz" id="names"><%= p.user.first_name %> <%= p.user.last_name %></td>
                    <td style="display:none;" id="submittedStatus"><%= p.submitted %></td>
                    <td><%= p.credit_union %> </td>
                    <td><%= p.activity %> </td>
                    <td><%= p.task %> </td>
                    <td><%= p.billing_options %> </td>

                    <td class="dropdown">
                      <p class="sunEntry" style="float:left;"><%= p.sun %></p><a class="glyphicon glyphicon-comment form-control-clear dropdown-toggle" data-toggle="dropdown" style="font-size:15px;padding-left:6px;vertical-align:center;float:left;"></a>
                      <ul id="login-dp" class="dropdown-menu feedback">
                        <li>
                          <div class="report">
                            <div class="col-sm-12">
                              <p class="noteclass"><%= p.sunnotes %></p>
                              <input name="screenshot" type="hidden" class="screen-uri">
                              <span class="screenshot pull-right"><i class="fa fa-camera cam" title="Take Screenshot"></i></span>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </td>
                    <td class="dropdown"><p class="monEntry" style="float:left;"><%= p.mon %></p>
                      <a class="glyphicon glyphicon-comment form-control-clear dropdown-toggle" data-toggle="dropdown" style="font-size:15px;padding-left:6px;vertical-align:center;"></a>
                      <ul id="login-dp" class="dropdown-menu feedback">
                        <li>
                          <div class="report">
                            <div class="col-sm-12">
                              <p class="noteclass"><%= p.monnotes %></p>
                              <input name="screenshot" type="hidden" class="screen-uri">
                              <span class="screenshot pull-right"><i class="fa fa-camera cam" title="Take Screenshot"></i></span>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </td>
                    <td class="dropdown"><p class="tueEntry" style="float:left;"><%= p.tue %></p>
                      <a class="glyphicon glyphicon-comment form-control-clear dropdown-toggle" data-toggle="dropdown" style="font-size:15px;padding-left:6px;vertical-align:center;"></a>
                      <ul id="login-dp" class="dropdown-menu feedback">
                        <li>
                          <div class="report">
                            <div class="col-sm-12">
                              <p class="noteclass"><%= p.tuenotes %></p>
                              <input name="screenshot" type="hidden" class="screen-uri">
                              <span class="screenshot pull-right"><i class="fa fa-camera cam" title="Take Screenshot"></i></span>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </td>
                    <td class="dropdown"><p class="wedEntry" style="float:left;"><%= p.wed %></p>
                      <a class="glyphicon glyphicon-comment form-control-clear dropdown-toggle" data-toggle="dropdown" style="font-size:15px;padding-left:6px;vertical-align:center;"></a>
                      <ul id="login-dp" class="dropdown-menu feedback">
                        <li>
                          <div class="report">
                            <div class="col-sm-12">
                              <p class="noteclass"><%= p.wednotes %></p>
                              <input name="screenshot" type="hidden" class="screen-uri">
                              <span class="screenshot pull-right"><i class="fa fa-camera cam" title="Take Screenshot"></i></span>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </td>
                    <td class="dropdown"><p class="thuEntry" style="float:left;"><%= p.thu %></p>
                      <a class="glyphicon glyphicon-comment form-control-clear dropdown-toggle" data-toggle="dropdown" style="font-size:15px;padding-left:6px;vertical-align:center;"></a>
                      <ul id="login-dp" class="dropdown-menu feedback">
                        <li>
                          <div class="report">
                            <div class="col-sm-12">
                              <p class="noteclass"><%= p.thunotes %></p>
                              <input name="screenshot" type="hidden" class="screen-uri">
                              <span class="screenshot pull-right"><i class="fa fa-camera cam" title="Take Screenshot"></i></span>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </td>
                    <td class="dropdown"><p class="friEntry" style="float:left;"><%= p.fri %></p>
                      <a class="glyphicon glyphicon-comment form-control-clear dropdown-toggle" data-toggle="dropdown" style="font-size:15px;padding-left:6px;vertical-align:center;"></a>
                      <ul id="login-dp" class="dropdown-menu feedback">
                        <li>
                          <div class="report">
                            <div class="col-sm-12">
                              <p class="noteclass"><%= p.frinotes %></p>
                              <input name="screenshot" type="hidden" class="screen-uri">
                              <span class="screenshot pull-right"><i class="fa fa-camera cam" title="Take Screenshot"></i></span>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </td>
                    <td class="dropdown"><p class="satEntry" style="float:left;"><%= p.sat %></p>
                      <a class="glyphicon glyphicon-comment form-control-clear dropdown-toggle" data-toggle="dropdown" style="font-size:15px;padding-left:6px;vertical-align:center;"></a>
                      <ul id="login-dp" class="dropdown-menu feedback">
                        <li>
                          <div class="report">
                            <div class="col-sm-12">
                              <p class="noteclass"><%= p.satnotes %></p>
                              <input name="screenshot" type="hidden" class="screen-uri">
                              <span class="screenshot pull-right"><i class="fa fa-camera cam" title="Take Screenshot"></i></span>
                            </div>
                          </div>
                        </li>
                      </ul>
                    <td><p class="totalEntry"><%= p.total %></p> </td>
                    <td style="display:none;" class="dateBlob"><%= p.date_of_time %></td>
                  </tr>
              <% end %>

              </tbody>

              <tbody>
              <tr class="success" id="totalsColumn">
                <td class="otherTotalCol"><p style="font-weight:bold;">Totals:</p></td>
                <td class="otherTotalCol"></td>
                <td class="otherTotalCol"></td>
                <td class="otherTotalCol"></td>
                <td><p style="font-weight:bold;" id="totalSun"></p></td>
                <td><p style="font-weight:bold;" id="totalMon"></p></td>
                <td><p style="font-weight:bold;" id="totalTue"></p></td>
                <td><p style="font-weight:bold;" id="totalWed"></p></td>
                <td><p style="font-weight:bold;" id="totalThu"></p></td>
                <td><p style="font-weight:bold;" id="totalFri"></p></td>
                <td><p style="font-weight:bold;" id="totalSat"></p></td>
                <td><p style="font-weight:bold;" id="totalTotal"></p></td>
              </tr>
              </tbody>


</table>
            <button type="button" id="clearMonth" class="btn btn-default btn-filter" style="margin:1px;">Return to Main</button>

          </div>
</div>
</div>
</div>
    </div>
